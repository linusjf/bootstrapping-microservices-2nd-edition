#!/usr/bin/env bash

# Parse command line arguments
while [[ $# -gt 0 ]]; do
  case $1 in
    --environment)
      ENVIRONMENT="$2"
      shift # past argument
      shift # past value
      ;;
    *)
      shift # past argument
      ;;
  esac
done

# Source .env file if it exists (maintains existing functionality)
if [ -f .env ]; then
  source .env
fi

# Export ENVIRONMENT variable
export ENVIRONMENT

terraform init
terraform apply -auto-approve \
  -var "app_version=$VERSION" \
  -var "client_id=$ARM_CLIENT_ID" \
  -var "client_secret=$ARM_CLIENT_SECRET" \
  -var "environment=$ENVIRONMENT" \
  -var "storage_account_name=$STORAGE_ACCOUNT_NAME" \
  -var "storage_access_key=$STORAGE_ACCESS_KEY"
